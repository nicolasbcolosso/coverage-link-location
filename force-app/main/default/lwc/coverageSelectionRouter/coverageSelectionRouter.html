<template>
  <div class="coverage-router-container">
    <!-- Loading State -->
    <template lwc:if={isLoading}>
      <div class="slds-is-relative loading-container">
        <lightning-spinner
          alternative-text="Loading"
          size="medium"
        ></lightning-spinner>
        <p class="slds-text-align_center slds-m-top_large slds-text-color_weak">
          Initializing coverage selection...
        </p>
      </div>
    </template>

    <!-- Error State -->
    <template lwc:elseif={hasError}>
      <div class="slds-p-around_medium">
        <div
          class="slds-illustration slds-illustration_small"
          aria-hidden="true"
        >
          <div
            class="slds-notify slds-notify_alert slds-alert_error slds-m-bottom_medium"
            role="alert"
          >
            <lightning-icon
              icon-name="utility:error"
              alternative-text="Error"
              variant="inverse"
              size="small"
              class="slds-m-right_x-small"
            ></lightning-icon>
            <span class="slds-text-body_regular"> {errorMessage} </span>
          </div>
          <div class="slds-text-align_center slds-m-top_medium">
            <lightning-button
              variant="brand"
              label="Retry"
              onclick={handleRetry}
              class="slds-m-right_small"
            ></lightning-button>
            <lightning-button
              variant="neutral"
              label="Close"
              onclick={handleClose}
            ></lightning-button>
          </div>
        </div>
      </div>
    </template>

    <!-- Ready State - Render appropriate component -->
    <template lwc:elseif={isReady}>
      <!-- New Coverage Selection Component -->
      <template lwc:if={showNewComponent}>
        <c-coverage-selection
          record-id={recordId}
          oncancelevent={handleCancel}
          onsavelimit={handleSaveLimit}
          onreloadviewpage={handleReloadViewPage}
        >
        </c-coverage-selection>
      </template>

      <!-- Old Lightning Add Remove Coverage Component -->
      <template lwc:elseif={showOldComponent}>
        <c-lightning-add-remove-coverage
          record-id={recordId}
          oncancelevent={handleCancel}
          onsavelimit={handleSaveLimit}
          onreloadviewpage={handleReloadViewPage}
        >
        </c-lightning-add-remove-coverage>
      </template>
    </template>
  </div>
</template>
